\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mypackage}[]
 
\RequirePackage{multicol}
\RequirePackage{tikz}
\usetikzlibrary{calc}
% \RequirePackage{xstring}
% \RequirePackage{xcolor}

\newcommand{\vggArch}{
    \begin{tabular}{|c|}
        \hline 
        \cellcolor{SkyBlue}Input 224$\times$224$\times$3\\ \hline
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$64  \\ 
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$64  \\ 
        \hline
        \cellcolor{Apricot}Max-pooling \\ 
        \hline
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$128 \\ 
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$128\\ 
        \hline
        \cellcolor{Apricot}Max-pooling \\ 
        \hline
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$256 \\
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$256 \\
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$256 \\ 
        \hline
        \cellcolor{Apricot}Max-pooling \\ 
        \hline
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$512 \\
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$512 \\
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$512 \\ 
        \hline
        \cellcolor{Apricot}Max-pooling \\ 
        \hline
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$512 \\
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$512 \\
        \cellcolor{SpringGreen}Conv. 3$\times$3$\times$512 \\ 
        \hline 
        \cellcolor{Apricot}Max-pooling \\ \hline
        \cellcolor{CadetBlue!70}FC - 4096 \\ \hline
        \cellcolor{CadetBlue!70}FC - 4096 \\ \hline
        \cellcolor{CadetBlue!70}FC - 1000 \\ \hline
        \cellcolor{Thistle!80}Softmax \\ \hline
    \end{tabular}
}


\newcommand{\resnetArch}{
    \usetikzlibrary{shapes,arrows}
    
    
    % Define block styles

    \tikzstyle{block} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Mahogany!50]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=SkyBlue]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=SpringGreen]
    \tikzstyle{pool} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Apricot]
     \tikzstyle{relu} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Thistle]
      \tikzstyle{bnorm} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Goldenrod]
    \tikzstyle{rect} = [rectangle, draw, text width=5em, text centered, minimum height=2em, node distance=1.5cm, fill=ForestGreen!40]
    \tikzstyle{fc} = [rectangle, draw, fill=CadetBlue!60, text width=9em, rounded corners, text centered, minimum height=2em]
    \tikzstyle{line} = [draw, -latex']
    
    \begin{multicols}{3}   

        \subsection*{ResNet}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
            \node [input] (input) {Input};
            \node [conv, below of=input] (conv1) {Conv. 7$\times$7$\times$64, /2};
            \node [bnorm, below of=conv1] (bn) {BatchNorm.};
            \node [relu, below of=bn] (relu) {ReLU};
            \node [pool, below of=relu] (maxpool) {Max pool. 3$\times$3, /2};
            \node [rect, below of=maxpool] (block1) {Layer 1  (N=1)};
            \node [rect, below of=block1] (block2) {Layer 2  (N=2)};
            \node [rect, below of=block2] (block3) {Layer 3  (N=4)};
            \node [rect, below of=block3] (block4) {Layer 4  (N=8)};
            \node [pool, below of=block4] (avgpool) {Average Pooling};
            \node [fc, below of=avgpool] (fc) {Fully connected (Classifier)};
            
            
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (bn);
            \path[line] (bn) -- (relu);
            \path[line] (relu) -- (maxpool);
            \path[line] (maxpool) -- (block1);
            \path[line] (block1) -- (block2);
            \path[line] (block2) -- (block3);
            \path[line] (block3) -- (block4);
            \path[line] (block4) -- (avgpool);
            \path[line] (avgpool) -- (fc);
        
        \end{tikzpicture}
        \vfill\null
        \columnbreak
        
        \subsection*{Basic Block}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
            \node [input] (input) {Input};
            \node [conv, below of=input] (conv1) {Conv. 3$\times$3$\times$64*N};
            \node [bnorm, below of=conv1] (bn) {BatchNorm.};
            
            \node [relu, below of=bn] (relu) {ReLU};
            \node [conv, below of=relu] (conv2) {Conv. 3$\times$3$\times$64*N};
            \node [bnorm, below of=conv2] (bn2) {BatchNorm.};
            \node  [block, below of=bn2] (plus) {+};
        
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (bn);
            \path[line] (bn) -- (relu);
            \path[line] (relu) -- (conv2);
            \path[line] (conv2) -- (bn2);
            \path[line] (bn2) -- (plus);
            \path[line] (input) -| node [near end]{}([xshift=1.5cm] input.east)
                                |- (plus.east) coordinate (plus);
        
        \end{tikzpicture}
        \vfill\null
        \columnbreak
        
        \subsection*{Bottleneck Block}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
            \node [input] (input) {Input};
            \node [conv, below of=input] (conv1) {Conv. 1$\times$1$\times$64*N};
            \node [bnorm, below of=conv1] (bn) {BatchNorm.};
            
            \node [relu, below of=bn] (relu) {ReLU};
            \node [conv, below of=relu] (conv2) {Conv. 3$\times$3$\times$64*N};
            \node [bnorm, below of=conv2] (bn2) {BatchNorm.};
            
            \node [relu, below of=bn2] (relu2) {ReLU};
            \node [conv, below of=relu2] (conv3) {Conv. 1$\times$1$\times$256*N};
            \node [bnorm, below of=conv3] (bn3) {BatchNorm.};
            
            \node  [block, below of=bn3] (plus) {+};
        
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (bn);
            \path[line] (bn) -- (relu);
            \path[line] (relu) -- (conv2);
            \path[line] (conv2) -- (bn2);
            \path[line] (bn2) -- (relu2);
            \path[line] (relu2) -- (conv3);
            \path[line] (conv3) -- (bn3);
            \path[line] (bn3) -- (plus);
            \path[line] (input) -| node [near end]{}([xshift=1.5cm] input.east)
                                |- (plus.east) coordinate (plus);
        \end{tikzpicture}
    
    \end{multicols}
}

\newcommand{\resnetSSD}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{block} = [rectangle, draw,  text centered, rounded corners, minimum height=2em]
    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=SpringGreen]
    \tikzstyle{rect} = [rectangle, draw, text width=5em, text centered, minimum height=2em, node distance=1.5cm, fill=ForestGreen!40]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=SkyBlue]
    \tikzstyle{pool} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Apricot]
    \tikzstyle{relu} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Thistle]
    \tikzstyle{bnorm} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Goldenrod]
    
    % \subsection*{Resnet-SSD}
    \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
    
        \node [input] (input) {Input};
        \node [conv, below of=input] (conv1) {Conv. 7$\times$7$\times$64, /2};
        \node [bnorm, below of=conv1] (bn) {BatchNorm, ReLU};
        % \node [relu, below of=bn] (relu) {ReLU};
        \node [pool, below of=bn] (maxpool) {3x3 max pool, /2};
        
        \node [rect, below of=maxpool] (block1) {Layer 1  (N=1)};
        \node [rect, below of=block1] (block2) {Layer 2  (N=2)};
        \node [rect, below of=block2] (block3) {Layer 3  (N=4)};
        \node [rect, below of=block3] (block4) {Layer 4  (N=8)};
        \draw[red,line width=0.6mm,] ($(input.north west)+(-1.5,0.4)$)  rectangle ($(block4.south east)+(1,-0.2)$);
        \node [text, text=red, font=\bfseries] at ($(input.east)+(+3.0,0.4)$) (resnet) {\LARGE ResNet};
        
        \node [conv, below= of block4] (ext1) {Conv. 1$\times$1$\times$256, /1};
        \node [conv, below of=ext1] (ext2) {Conv. 3$\times$3$\times$512, /2};
        \node [conv, below of=ext2] (ext3) {Conv. 1$\times$1$\times$128, /1};
        \node [conv, below of=ext3] (ext4) {Conv. 3$\times$3$\times$256, /2};
        \node [conv, below of=ext4] (ext5) {Conv. 1$\times$1$\times$128, /1};
        \node [conv, below of=ext5] (ext6) {Conv. 3$\times$3$\times$256, /1};
        \draw[blue,line width=0.6mm,] ($(ext1.north west)+(-0.4,0.2)$) rectangle ($(ext6.south east)+(0.4,-0.2)$);
        \node [text, text=blue, font=\bfseries] at ($(ext1.north)+(+0.0,0.6)$) (resnet) {\Large Extra layers};
        
        \node [conv, left= of ext2] (cls4) {Conv. 3$\times$3$\times$6*C};
        \node [conv, left= of ext4] (cls5) {Conv. 3$\times$3$\times$4*C};
        \node [conv, left= of ext6] (cls6) {Conv. 3$\times$3$\times$4*C};
        \node [conv, above= of cls4] (cls3) {Conv. 3$\times$3$\times$6*C};
        \node [conv, above= of cls3] (cls2) {Conv. 3$\times$3$\times$6*C};
        \node [conv, above= of cls2] (cls1) {Conv. 3$\times$3$\times$4*C};
        \draw[black!30!green,line width=0.6mm,] ($(cls1.north west)+(-0.3,0.6)$)  rectangle ($(cls6.south east)+(0.3,-0.2)$);
        \node [text, text=black!30!green, font=\bfseries] at ($(cls1.north)+(+0.0,1.4)$) (resnet) {\LARGE Classifier};
        
        \node [conv, right= of ext2] (loc4) {Conv. 3$\times$3$\times$24};
        \node [conv, right= of ext4] (loc5) {Conv. 3$\times$3$\times$16};
        \node [conv, right= of ext6] (loc6) {Conv. 3$\times$3$\times$16};
        \node [conv, above= of loc4] (loc3) {Conv. 3$\times$3$\times$24};
        \node [conv, above= of loc3] (loc2) {Conv. 3$\times$3$\times$24};
        \node [conv, above= of loc2] (loc1) {Conv. 3$\times$3$\times$16};
        \draw[black!30!green,line width=0.6mm,] ($(loc1.north west)+(-0.3,0.6)$)  rectangle ($(loc6.south east)+(0.3,-0.2)$);
        \node [text, text=black!30!green,, font=\bfseries] at ($(loc1.north)+(+0.0,1.4)$) (resnet) {\LARGE Location};

        \path[line] (input) -- (conv1);
        \path[line] (conv1) -- (bn);
        % \path[line] (bn) -- (relu);
        \path[line] (bn) -- (maxpool);
        \path[line] (maxpool) -- (block1);
        \path[line] (block1) -- (block2);
        \path[line] (block2) -- (block3);
        \path[line] (block3) -- (block4);
        \path[line] (block4) -- (ext1);
        \path[line] (ext1) -- (ext2);
        \path[line] (ext2) -- (ext3);
        \path[line] (ext3) -- (ext4);
        \path[line] (ext4) -- (ext5);
        \path[line] (ext5) -- (ext6);
        
        \path[line] (ext6) -- (cls6);
        \path[line] (ext4) -- (cls5);
        \path[line] (ext2) -- (cls4);
        \path[line] (block4) -- (cls3);
        \path[line] (block3) -- (cls2);
        \path[line] (block2) -- (cls1);
        
         \path[line] (ext6) -- (loc6);
        \path[line] (ext4) -- (loc5);
        \path[line] (ext2) -- (loc4);
        \path[line] (block4) -- (loc3);
        \path[line] (block3) -- (loc2);
        \path[line] (block2) -- (loc1);
                            
    \end{tikzpicture}

}

    %   \subsection*{Simple detector}
    %     \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
    %           \node [block] (input) {Input};
    %         \node [block, below of=input] (conv1) {7x7 conv, 64, /2};
    %         \node [block, below of=conv1] (bn) {BatchNorm};
    %         \node [block, below of=bn] (relu) {ReLU};
    %         \node [block, below of=relu] (maxpool) {3x3 max pool, /2};
    %         \node [rect, below of=maxpool] (block1) {Block 1  (N=1)};
    %         \node [rect, below of=block1] (block2) {Block 2  (N=2)};
    %         \node [rect, below of=block2] (block3) {Block 3  (N=4)};
    %         \node [rect, below of=block3] (block4) {Block 4  (N=8)};
    %         \node [head, below of=block4] (avgpool) {Average Pooling};
    %         \node [head, below of=avgpool] (flatten) {Flatten};
    %         \node [head, below of= flatten] (cls) {Fully connected \textbf{Classifier}};
    %         \node [head, below of=cls, node distance=1.5cm] (loc) {7x7 conv, 4 \textbf{Location}};
            
    %         \path[line] (input) -- (conv1);
    %         \path[line] (conv1) -- (bn);
    %         \path[line] (bn) -- (relu);
    %         \path[line] (relu) -- (maxpool);
    %         \path[line] (maxpool) -- (block1);
    %         \path[line] (block1) -- (block2);
    %         \path[line] (block2) -- (block3);
    %         \path[line] (block3) -- (block4);
    %         \path[line] (block4) -- (avgpool);
    %         \path[line] (avgpool) --  (flatten);	
    %         \path[line] (flatten) --  (cls);	
    %         \path[line] (block4) -| node [near end]{}([xshift=1.5cm] block4.east)
    %                             |- (loc.east) coordinate (loc);
    %     \end{tikzpicture}