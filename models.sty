\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{models}[]
 
\RequirePackage{xcolor}
\RequirePackage{multicol}
\RequirePackage{tikz}
\usetikzlibrary{calc}

\newcommand{\convcol}{SpringGreen!60}
\newcommand{\blockcol}{Goldenrod}
\newcommand{\inputcol}{CornflowerBlue}
\newcommand{\poolcol}{Apricot}
\newcommand{\relucol}{Thistle}
\newcommand{\bnormcol}{Emerald}
\newcommand{\fccol}{CadetBlue!60}
\newcommand{\sepconvcol}{Dandelion}
\newcommand{\convtdcol}{Violet!40}


\newcommand{\pipeline}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{rect} = [rectangle, draw, text centered,fill=\blockcol]
    \tikzstyle{det} = [rectangle, draw, text centered,fill=Apricot]
    \tikzstyle{input} = [rectangle, draw, text centered,fill=\inputcol]

    % \subsection*{pipeline}
    \begin{tikzpicture}[every text node part/.style={align=center}]
    
        \node [input] (input) {Video};
        \node [rect] at ($(input.center)+(2.0,-1.)$) (block1) {Pre-processing};
        \node [rect] at ($(input.center)+(4.0, 0)$) (block2) {Batching};
        \node [det] at ($(block1.center)+(4.0, 0.)$) (block3) {Detector};
        \node [rect] at ($(block2.center)+(4.0, 0.)$) (block4) {Filtering};
        \node [rect] at ($(block3.center)+(4.0, 0.)$) (block5) {Tracking};
        \node [rect, fill=\fccol] at ($(block4.center)+(4.0, 0.)$) (block6) {Data};
        
        \path[line] (input) -- (block1);
        \path[line] (block1) -- (block2);
        \path[line] (block2) -- (block3);
        \path[line] (block3) -- (block4);
        \path[line] (block4) -- (block5);
        \path[line] (block4) -- (block6);
        \path[line] (block5) -- (block6);
    \end{tikzpicture}
}





\newcommand{\vggArch}{
    \begin{tabular}{|c|}
        \hline 
        \cellcolor{\inputcol}Input 224$\times$224$\times$3\\ \hline
        \cellcolor{\convcol}Conv. 3$\times$3$\times$64 \tiny (Conv1\_1) \\ 
        \cellcolor{\convcol}Conv. 3$\times$3$\times$64 \tiny (Conv1\_2) \\ 
        \hline
        \cellcolor{\poolcol}Max-pool. 2\x 2 /2 \tiny (Pool1) \\
        \hline
        \cellcolor{\convcol}Conv. 3$\times$3$\times$128 \tiny (Conv2\_1) \\ 
        \cellcolor{\convcol}Conv. 3$\times$3$\times$128 \tiny (Conv2\_2) \\ 
        \hline
        \cellcolor{\poolcol}Max-pool. 2\x 2 /2 \tiny (Pool2) \\
        \hline
        \cellcolor{\convcol}Conv. 3$\times$3$\times$256 \tiny (Conv3\_1) \\
        \cellcolor{\convcol}Conv. 3$\times$3$\times$256 \tiny (Conv3\_2) \\
        \cellcolor{\convcol}Conv. 3$\times$3$\times$256 \tiny (Conv3\_3) \\
        \hline
        \cellcolor{\poolcol}Max-pool. 2\x 2 /2 \tiny (Pool3) \\
        \hline
        \cellcolor{\convcol}Conv. 3$\times$3$\times$512 \tiny (Conv4\_1) \\
        \cellcolor{\convcol}Conv. 3$\times$3$\times$512 \tiny (Conv4\_2) \\
        \cellcolor{\convcol}Conv. 3$\times$3$\times$512 \tiny (Conv4\_3) \\
        \hline
        \cellcolor{\poolcol}Max-pool. 2\x 2 /2 \tiny (Pool4) \\
        \hline
        \cellcolor{\convcol}Conv. 3$\times$3$\times$512 \tiny (Conv5\_1) \\
        \cellcolor{\convcol}Conv. 3$\times$3$\times$512 \tiny (Conv5\_2) \\
        \cellcolor{\convcol}Conv. 3$\times$3$\times$512 \tiny (Conv5\_3) \\
        \hline 
        \cellcolor{\poolcol}Max-pool. 2\x 2 /2 \tiny (Pool\_5) \\ \hline
        \cellcolor{\fccol}FC - 4096 \tiny (FC6) \\ \hline
        \cellcolor{\fccol}FC - 4096 \tiny (FC7) \\ \hline
        \cellcolor{\fccol}FC - 1000 \tiny (FC8) \\ \hline
        \cellcolor{Rhodamine!40}Softmax \\ \hline
    \end{tabular}
}


\newcommand{\VGGSSD}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{fline} = [draw, -latex, line width=0.8pt]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\convcol, node distance=1.15cm ]
    \tikzstyle{rect} = [rectangle, draw, text centered, minimum height=2em, fill=\blockcol]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\inputcol]
    \tikzstyle{pool} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\poolcol]

    \subsection*{SSD}
    \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
    
        \node [input] (input) {Input};
        \node [rect, below of=input] (block1) {Conv1\_1 - Conv4\_3};
        \node [rect, below of=block1] (block2) {Conv5\_1 - Conv5\_3};
        \node [pool, below of=block2] (p1) {Max pool. 3$\times$3 P:1};
        
         \node [conv, below of=p1,text width=33mm,] (ext-1) {Conv. 3$\times$3$\times$1024 P:6 D:6};
         \node [conv, below of=ext-1] (ext0) {Conv. 1$\times$1$\times$1024};
    
        \draw[blue,line width=0.6mm,] ($(block1.north west)+(-0.2,0.2)$)  rectangle ($(block2.south east)+(0.2,-3.65)$);
        \node [text=blue, font=\bfseries] at ($(input.east)+(+3.2,-0.8)$) (resnet) {\Large VGG-16};
        
        % \node [text=black, font=\bfseries] at ($(input.west)+(-3.5,0.4)$) (header) {\LARGE ResNet-SSD};
        
        \node [conv, below= of ext0] (ext1) {Conv. 1$\times$1$\times$256 };
        \node [conv, below of=ext1] (ext2) {Conv. 3$\times$3$\times$512 /2};
        \node [conv, below of=ext2] (ext3) {Conv. 1$\times$1$\times$128};
        \node [conv, below of=ext3] (ext4) {Conv. 3$\times$3$\times$256 /2};
        \node [conv, below of=ext4] (ext5) {Conv. 1$\times$1$\times$128};
        \node [conv, below of=ext5] (ext6) {Conv. 3$\times$3$\times$256 P:0};
        \node [conv, below of=ext6] (ext7) {Conv. 1$\times$1$\times$128};
        \node [conv, below of=ext7] (ext8) {Conv. 3$\times$3$\times$256 P:0};
        \draw[red,line width=0.6mm, dash pattern=on 6pt off 5pt,] ($(ext1.north west)+(-0.5,0.2)$) rectangle ($(ext8.south east)+(0.2,-0.2)$);
        \node [text=red, font=\bfseries] at ($(ext1.north)+(+0.0,0.6)$) (extra) {\Large Extra layers};
        
        \node [conv, left= of ext3] (cls4) {Conv. 3$\times$3$\times$6*C};
        \node [conv, below= of cls4] (cls5) {Conv. 3$\times$3$\times$4*C};
        \node [conv, below= of cls5] (cls6) {Conv. 3$\times$3$\times$4*C};
        
        \node [conv, above= of cls4] (cls3) {Conv. 3$\times$3$\times$6*C};
        \node [conv, above= of cls3] (cls2) {Conv. 3$\times$3$\times$6*C};
        \node [conv, above= of cls2] (cls1) {Conv. 3$\times$3$\times$4*C};
        \draw[black!30!green,line width=0.6mm,] ($(cls1.north west)+(-0.3,0.6)$)  rectangle ($(cls6.south east)+(0.3,-0.2)$);
        \node [text=black!30!green, font=\bfseries] at ($(cls1.north)+(+0.0,1.4)$) (class) {\LARGE Class};
        
        \node [conv, right= of ext3] (loc4) {Conv. 3$\times$3$\times$6*4};
        \node [conv, below= of loc4] (loc5) {Conv. 3$\times$3$\times$4*4};
        \node [conv, below= of loc5] (loc6) {Conv. 3$\times$3$\times$4*4};
        \node [conv, above= of loc4] (loc3) {Conv. 3$\times$3$\times$6*4};
        \node [conv, above= of loc3] (loc2) {Conv. 3$\times$3$\times$6*4};
        \node [conv, above= of loc2] (loc1) {Conv. 3$\times$3$\times$4*4};
        \draw[black!30!green,line width=0.6mm,] ($(loc1.north west)+(-0.3,0.6)$)  rectangle ($(loc6.south east)+(0.3,-0.2)$);
        \node [text=black!30!green,, font=\bfseries] at ($(loc1.north)+(+0.0,1.4)$) (loc) {\LARGE Location};

        \path[line] (input) -- (block1);
        \path[line] (block1) -- (block2);
        \path[line] (block2) -- (p1);
        \path[line] (p1) -- (ext-1);
        \path[line] (ext-1) -- (ext0);
        \path[line] (ext0) -- (ext1);
        \path[line] (ext1) -- (ext2);
        \path[line] (ext2) -- (ext3);
        \path[line] (ext3) -- (ext4);
        \path[line] (ext4) -- (ext5);
        \path[line] (ext5) -- (ext6);
        \path[line] (ext7) -- (ext8);
        \path[line] (ext6) -- (ext7);
        
        \path[fline] (ext8) -- (cls6);
        \path[fline] (ext6) -- (cls5);
        \path[fline] (ext4) -- (cls4);
        \path[fline] (ext2) -- (cls3);
        \path[fline] (ext0) -- (cls2);
        \path[fline] (block1) -- (cls1);
        
        \path[fline] (ext8) -- (loc6);
        \path[fline] (ext6) -- (loc5);
        \path[fline] (ext4) -- (loc4);
        \path[fline] (ext2) -- (loc3);
        \path[fline] (ext0) -- (loc2);
        \path[fline] (block1) -- (loc1);
                            
    \end{tikzpicture}

}



\newcommand{\resnetArch}{
    \usetikzlibrary{shapes,arrows}
    
    % Define block styles

    \tikzstyle{block} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=Rhodamine!40]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\inputcol]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\convcol]
    \tikzstyle{pool} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\poolcol]
     \tikzstyle{relu} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\relucol]
      \tikzstyle{bnorm} = [rectangle, draw,  text centered, rounded corners, minimum height=2em, fill=\bnormcol]
    \tikzstyle{rect} = [rectangle, draw, text width=5em, text centered, minimum height=2em, node distance=1.5cm, fill=\blockcol]
    \tikzstyle{fc} = [rectangle, draw, fill=\fccol, text width=9em, rounded corners, text centered, minimum height=2em]
    \tikzstyle{line} = [draw, -latex]
    
    \begin{multicols}{3}   

        \subsection*{ResNet}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
            \node [input] (input) {Input};
            \node [conv, below of=input] (conv1) {Conv. 7$\times$7$\times$64 /2 P:3};
            \node [bnorm, below of=conv1] (bn) {BatchNorm.};
            \node [relu, below of=bn] (relu) {ReLU};
            \node [pool, below of=relu] (maxpool) {Max pool. 3$\times$3 /2};
            \node [rect, below of=maxpool] (block1) {Layer 1  (N=1)};
            \node [rect, below of=block1] (block2) {Layer 2  (N=2)};
            \node [rect, below of=block2] (block3) {Layer 3  (N=4)};
            \node [rect, below of=block3] (block4) {Layer 4  (N=8)};
            \node [pool, below of=block4] (avgpool) {Average Pooling};
            \node [fc, below of=avgpool] (fc) {Fully connected (Classifier)};
            
            
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (bn);
            \path[line] (bn) -- (relu);
            \path[line] (relu) -- (maxpool);
            \path[line] (maxpool) -- (block1);
            \path[line] (block1) -- (block2);
            \path[line] (block2) -- (block3);
            \path[line] (block3) -- (block4);
            \path[line] (block4) -- (avgpool);
            \path[line] (avgpool) -- (fc);
        
        \end{tikzpicture}
        \vfill\null
        \columnbreak
        
        \subsection*{Basic Block}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
            \node [input] (input) {Input};
            \node [conv, below of=input] (conv1) {Conv. 3$\times$3$\times$64*N};
            \node [bnorm, below of=conv1] (bn) {BatchNorm.};
            
            \node [relu, below of=bn] (relu) {ReLU};
            \node [conv, below of=relu] (conv2) {Conv. 3$\times$3$\times$64*N};
            \node [bnorm, below of=conv2] (bn2) {BatchNorm.};
            \node  [block, below of=bn2] (plus) {+};
        
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (bn);
            \path[line] (bn) -- (relu);
            \path[line] (relu) -- (conv2);
            \path[line] (conv2) -- (bn2);
            \path[line] (bn2) -- (plus);
            \path[line] (input) -| node [near end]{}([xshift=1.5cm] input.east)
                                |- (plus.east) coordinate (plus);
        
        \end{tikzpicture}
        \vfill\null
        \columnbreak
        
        \subsection*{Bottleneck Block}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
            \node [input] (input) {Input};
            \node [conv, below of=input] (conv1) {Conv. 1$\times$1$\times$64*N};
            \node [bnorm, below of=conv1] (bn) {BatchNorm.};
            
            \node [relu, below of=bn] (relu) {ReLU};
            \node [conv, below of=relu] (conv2) {Conv. 3$\times$3$\times$64*N};
            \node [bnorm, below of=conv2] (bn2) {BatchNorm.};
            
            \node [relu, below of=bn2] (relu2) {ReLU};
            \node [conv, below of=relu2] (conv3) {Conv. 1$\times$1$\times$256*N};
            \node [bnorm, below of=conv3] (bn3) {BatchNorm.};
            
            \node  [block, below of=bn3] (plus) {+};
        
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (bn);
            \path[line] (bn) -- (relu);
            \path[line] (relu) -- (conv2);
            \path[line] (conv2) -- (bn2);
            \path[line] (bn2) -- (relu2);
            \path[line] (relu2) -- (conv3);
            \path[line] (conv3) -- (bn3);
            \path[line] (bn3) -- (plus);
            \path[line] (input) -| node [near end]{}([xshift=1.5cm] input.east)
                                |- (plus.east) coordinate (plus);
        \end{tikzpicture}
    
    \end{multicols}
}

\newcommand{\resnetSSD}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{fline} = [draw, -latex, line width=0.8pt]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=43mm, node distance= 0.25cm]
    \tikzstyle{sepconv} = [rectangle, draw,  text centered, rounded corners, fill=\sepconvcol, text width=43mm, node distance= 0.25cm]
    \tikzstyle{rect} = [rectangle, draw, text centered, fill=\blockcol, minimum height=1em, node distance=0.25cm, text width=33mm]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners,  fill=\inputcol]
    \tikzstyle{box} = [rectangle, draw, text centered, fill=Orchid!60, node distance=0.3cm, text width=30mm]
    
    \begin{multicols}{2}   
    \subsection*{ResNet34-SSD}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
        
            \node [input] (input) {Input [300\x 300]};
            \node [conv, below=of input] (conv1) {Conv. 7$\times$7$\times$64 /2 P:3};
            \node [rect, below=of conv1] (block1) {Layer 1};
            \node [rect, below=of block1] (block2) {Layer 2 \textbf{[38\x 38\x 128]}};
            \node [rect, below=of block2] (block3) {Layer 3 \textbf{[19\x 19\x 256]}};
            \node [rect, below=of block3] (block4) {Layer 4 \textbf{[10\x 10\x 512]}};
            \node [conv, below=of block4] (ext1) {Conv. 1$\times$1$\times$256};
            \node [conv, below=of ext1] (ext2) {Conv. 3$\times$3$\times$512~/2 \textbf{[5\x 5\x 512]}};
            \node [conv, below=of ext2] (ext3) {Conv. 1$\times$1$\times$128};
            \node [conv, below=of ext3] (ext4) {Conv. 3$\times$3$\times$256~/2 \textbf{[3\x 3\x 256]}};
            \node [conv, below=of ext4] (ext5) {Conv. 1$\times$1$\times$128};
            \node [conv, below=of ext5] (ext6) {Conv. 3$\times$3$\times$256~P:0 \textbf{[1\x 1\x 256]}};
            \node [box, below=of ext6] (cls) {Classification};
            \node [box, below=of cls] (loc) {Localization};
            
        %   \draw[blue,line width=0.4mm] ($(conv1.north west)+(-0.3,0.1)$)  rectangle ($(conv1.south east)+(0.3,-5.3)$);
            \draw[red,line width=0.4mm, dash pattern=on 6pt off 5pt,] ($(ext1.north west)+(-0.3,0.1)$) rectangle ($(ext6.south east)+(0.3,-0.1)$);

            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (block1);
            \path[line] (block1) -- (block2);
            \path[line] (block2) -- (block3);
            \path[line] (block3) -- (block4);
            \path[line] (block4) -- (ext1);
            \path[line] (ext1) -- (ext2);
            \path[line] (ext2) -- (ext3);
            \path[line] (ext3) -- (ext4);
            \path[line] (ext4) -- (ext5);
            \path[line] (ext5) -- (ext6);
            
            \path[fline] (block2) -| node [near end]{}([xshift=-1.2cm] block2.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (block3) -| node [near end]{}([xshift=-1.18cm] block3.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (block4) -| node [near end]{}([xshift=-1.16cm] block4.west)
                                        |- (cls.west) coordinate (cls);  
            \path[fline] (ext2) -| node [near end]{}([xshift=-.64cm] ext2.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (ext4) -| node [near end]{}([xshift=-.62cm] ext4.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (ext6) -| node [near end]{}([xshift=-.6cm] ext6.west)
                                        |- (cls.west) coordinate (cls);
            
    
            \path[fline] (block2) -| node [near end]{}([xshift=1.2cm] block2.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (block3) -| node [near end]{}([xshift=1.18cm] block3.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (block4) -| node [near end]{}([xshift=1.16cm] block4.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (ext2) -| node [near end]{}([xshift=.64cm] ext2.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (ext4) -| node [near end]{}([xshift=.62cm] ext4.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (ext6) -| node [near end]{}([xshift=.6cm] ext6.east)
                                        |- (loc.east) coordinate (loc);
        \end{tikzpicture}
        
        \subsection*{XceptionA-SSD}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
        
            \node [input] (input) {Input [300\x 300]};
            \node [conv, below=of input] (conv1) {Conv. 3$\times$3$\times$32~/2 P:0};
            \node [conv, below=of conv1] (conv2) {Conv. 3$\times$3$\times$64 P:0};
    
            \node [rect, below=of conv2] (block2) {Blocks 1, 2 \textbf{[37\x 37 \x 256]}};
            \node [rect, below=of block2] (block4) {Blocks~3-11 \textbf{[19\x 19 \x 728]}};
            \node [rect, below=of block4] (block12) {Block 12};
            \node [sepconv, below=of block12] (conv4) {SepConv.~3$\times$3$\times$1536};
            \node [sepconv, below=of conv4] (conv5) {SepConv.~3$\times$3$\times$2048  \textbf{[10\x 10 \x 2048]}};
            \node [conv, below=of conv5] (ext1) {Conv. 1$\times$1$\times$256};
            \node [conv, below=of ext1] (ext2) {Conv. 3$\times$3$\times$512~/2  \textbf{[5\x 5 \x 512]}};
            \node [conv, below=of ext2] (ext3) {Conv. 1$\times$1$\times$128};
            \node [conv, below=of ext3] (ext4) {Conv. 3$\times$3$\times$256~/2 \textbf{[3\x 3\x 256]}};
            \node [conv, below=of ext4] (ext5) {Conv. 1$\times$1$\times$128};
            \node [conv, below=of ext5] (ext6) {Conv. 3$\times$3$\times$256~P:0  \textbf{[1\x 1\x 256]}};
            \node [box, below=of ext6] (cls) {Classification};
            \node [box, below=of cls] (loc) {Localization};
            
            % \draw[blue,line width=0.4mm] ($(conv1.north west)+(-0.3,0.1)$)  rectangle ($(conv5.south east)+(0.3,-0.1)$);
            \draw[red,line width=0.4mm, dash pattern=on 6pt off 5pt,] ($(ext1.north west)+(-0.3,0.1)$) rectangle ($(ext6.south east)+(0.3,-0.1)$);

            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (conv2);
            \path[line] (conv2) -- (block2);
            \path[line] (block2) -- (block4);
            \path[line] (block4) -- (block12);
            \path[line] (block12) -- (conv4);
            \path[line] (conv4) -- (conv5);
            \path[line] (conv5) -- (ext1);
            \path[line] (ext1) -- (ext2);
            \path[line] (ext2) -- (ext3);
            \path[line] (ext3) -- (ext4);
            \path[line] (ext4) -- (ext5);
            \path[line] (ext5) -- (ext6);
            
            % \draw [->,thick] (block2.west) to [bend right=45]  (cls.west);
            
            \path[fline] (block2) -| node [near end]{}([xshift=-1.2cm] block2.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (block4) -| node [near end]{}([xshift=-1.18cm] block4.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (conv5) -| node [near end]{}([xshift=-0.66cm] conv5.west)
                                        |- (cls.west) coordinate (cls);                   
            \path[fline] (ext2) -| node [near end]{}([xshift=-.64cm] ext2.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (ext4) -| node [near end]{}([xshift=-.62cm] ext4.west)
                                        |- (cls.west) coordinate (cls);
            \path[fline] (ext6) -| node [near end]{}([xshift=-.6cm] ext6.west)
                                        |- (cls.west) coordinate (cls);
            
    
            \path[fline] (block2) -| node [near end]{}([xshift=1.2cm] block2.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (block4) -| node [near end]{}([xshift=1.18cm] block4.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (conv5) -| node [near end]{}([xshift=0.66cm] conv5.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (ext2) -| node [near end]{}([xshift=.64cm] ext2.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (ext4) -| node [near end]{}([xshift=.62cm] ext4.east)
                                        |- (loc.east) coordinate (loc);
            \path[fline] (ext6) -| node [near end]{}([xshift=.6cm] ext6.east)
                                        |- (loc.east) coordinate (loc);
                                
        \end{tikzpicture}
    \end{multicols}
}


\newcommand{\nasnetSSD}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{redrect} = [rectangle, draw, text centered, node distance=0.25cm, fill=ForestGreen!50]
    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{fline} = [draw, -latex, line width=0.8pt]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=40mm, node distance= 0.25cm]
    \tikzstyle{rect} = [rectangle, draw, text centered, fill=\blockcol, minimum height=1em, node distance=0.25cm, text width=30mm]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners,  fill=\inputcol]
    \tikzstyle{box} = [rectangle, draw, text centered, fill=Orchid!60, node distance=0.3cm, text width=30mm]

    \subsection*{NASNet-A-Mobile-SSD}
    \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
    
        \node [input] (input) {Input [224\x 224]};
        \node [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=33mm, node distance= 0.25cm] at ($(input.south)+(-2.0,-0.6)$) (conv1) {Conv. 3$\times$3$\times$32 /2};

        \node [redrect] at ($(conv1.south)+(4.0,-0.2)$) (block1) {Reduction Cell};
        \node [redrect] at ($(block1.south)+(-4.0,-0.2)$) (block2) {Reduction Cell};
        \node [rect] at ($(block2.south)+(4.0,-0.2)$) (cell0) {Normal Cell};
        \node [rect] at ($(cell0.south)+(-4.0,-0.2)$) (cell1) {Normal Cell};
        \node [rect] at ($(cell1.south)+(4.0,-0.2)$) (cell2) {Normal Cell};
        \node [rect] at ($(cell2.south)+(-4.0,-0.4)$) (cell3) {Normal Cell \textbf{[28\x 28\x 264]}};
        \node [redrect] at ($(cell3.south)+(4.0,-0.2)$) (block7) {Reduction Cell};
        \node [rect] at ($(block7.south)+(-4.0,-0.2)$) (cell6) {Normal Cell};
        \node [rect] at ($(cell6.south)+(4.0,-0.2)$) (cell7) {Normal Cell};
        \node [rect] at ($(cell7.south)+(-4.0,-0.2)$) (cell8) {Normal Cell};
        \node [rect] at ($(cell8.south)+(4.0,-0.4)$) (cell9) {Normal Cell \textbf{[14\x 14\x 528]}};
        \node [redrect] at ($(cell9.south)+(-4.0,-0.2)$) (block12) {Reduction Cell};
        \node [rect] at ($(block12.south)+(4.0,-0.2)$) (cell12) {Normal Cell};
        \node [rect] at ($(cell12.south)+(-4.0,-0.2)$) (cell13) {Normal Cell};
        \node [rect] at ($(cell13.south)+(4.0,-0.2)$) (cell14) {Normal Cell};
        \node [rect] at ($(cell14.south)+(-4.0,-0.4)$) (cell15) {Normal Cell \textbf{[7\x 7\x 1056]}};
        \node [conv]  at ($(cell15.south)+(2.0,-0.8)$) (ext1) {Conv. 1$\times$1$\times$256};
        \node [conv, below=of ext1] (ext2) {Conv. 3$\times$3$\times$512~/2 \textbf{[4\x 4\x 512]}};
        \node [conv, below=of ext2] (ext3) {Conv. 1$\times$1$\times$128};
        \node [conv, below=of ext3] (ext4) {Conv. 3$\times$3$\times$256~/2 \textbf{[2\x 2\x 256]}};
        
        \node [box, below=of ext4] (cls) {Classification};
        \node [box, below=of cls] (loc) {Localization};

        % \draw[blue,line width=0.4mm] ($(cell1.north west)+(-0.2,2.2)$)  rectangle ($(cell14.south east)+(0.2,-1.1)$);
        \draw[red,line width=0.4mm, dash pattern=on 6pt off 5pt,] ($(ext1.north west)+(-0.3,0.1)$) rectangle ($(ext4.south east)+(0.8,-0.1)$);

        \path[line] (input) -- (conv1);
        \path[line] (conv1) -- (block1);
        
        \path[line] (conv1) -- (block2);
        \path[line] (block1) -- (block2);
        
        \path[line] (block1) -- (cell0);
        \path[line] (block2) -- (cell0);
        
        \path[line] (block2) -- (cell1);
        \path[line] (cell0) -- (cell1);
        
        \path[line] (cell0) -- (cell2);
        \path[line] (cell1) -- (cell2);
        
        \path[line] (cell1) -- (cell3);
        \path[line] (cell2) -- (cell3);
        
        \path[line] (cell2) -- (block7);
        \path[line] (cell3) -- (block7);
        
        \path[line] (block7) -- (cell6);
        \path[line] (cell3) -- (cell6);
        
        \path[line] (cell6) -- (cell7);
        \path[line] (block7) -- (cell7);
        
        \path[line] (cell6) -- (cell8);
        \path[line] (cell7) -- (cell8);
        
        \path[line] (cell8) -- (cell9);
        \path[line] (cell7) -- (cell9);
        
        \path[line] (cell8) -- (block12);
        \path[line] (cell9) -- (block12);
        
        \path[line] (block12) -- (cell12);
        \path[line] (cell9) -- (cell12);
        
        \path[line] (block12) -- (cell13);
        \path[line] (cell12) -- (cell13);
        
        \path[line] (cell12) -- (cell14);
        \path[line] (cell13) -- (cell14);
        
        \path[line] (cell14) -- (cell15);
        \path[line] (cell13) -- (cell15);
        
        \path[line] (cell15) -- (ext1);
        \path[line] (ext1) -- (ext2);
        \path[line] (ext2) -- (ext3);
        \path[line] (ext3) -- (ext4);

         \path[fline] (cell3) -| node [near end]{}([xshift=-0.58cm] cell3.west)
                                    |- (cls.west) coordinate (cls);
        \path[fline] (cell9) -| node [near end]{}([xshift=-4.56cm] cell9.west)
                                    |- (cls.west) coordinate (cls);
        \path[fline] (cell15) -| node [near end]{}([xshift=-0.54cm] cell15.west)
                                    |- (cls.west) coordinate (cls);                   
        \path[fline] (ext2) -| node [near end]{}([xshift=-2.02cm] ext2.west)
                                    |- (cls.west) coordinate (cls);
        \path[fline] (ext4) -| node [near end]{}([xshift=-2.0cm] ext4.west)
                                    |- (cls.west) coordinate (cls);

        \path[fline] (cell3) -| node [near end]{}([xshift=4.58cm] cell3.east)
                                    |- (loc.east) coordinate (loc);
        \path[fline] (cell9) -| node [near end]{}([xshift=0.56cm] cell9.east)
                                    |- (loc.east) coordinate (loc);
        \path[fline] (cell15) -| node [near end]{}([xshift=4.54cm] cell15.east)
                                    |- (loc.east) coordinate (loc);
        \path[fline] (ext2) -| node [near end]{}([xshift=2.02cm] ext2.east)
                                    |- (loc.east) coordinate (loc);
        \path[fline] (ext4) -| node [near end]{}([xshift=2.0cm] ext4.east)
                                    |- (loc.east) coordinate (loc);
                            
    \end{tikzpicture}

}    



    %   \subsection*{Simple detector}
    %     \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
    %           \node [block] (input) {Input};
    %         \node [block, below of=input] (conv1) {7x7 conv, 64, /2};
    %         \node [block, below of=conv1] (bn) {BatchNorm};
    %         \node [block, below of=bn] (relu) {ReLU};
    %         \node [block, below of=relu] (maxpool) {3x3 max pool, /2};
    %         \node [rect, below of=maxpool] (block1) {Block 1  (N=1)};
    %         \node [rect, below of=block1] (block2) {Block 2  (N=2)};
    %         \node [rect, below of=block2] (block3) {Block 3  (N=4)};
    %         \node [rect, below of=block3] (block4) {Block 4  (N=8)};
    %         \node [head, below of=block4] (avgpool) {Average Pooling};
    %         \node [head, below of=avgpool] (flatten) {Flatten};
    %         \node [head, below of= flatten] (cls) {Fully connected \textbf{Classifier}};
    %         \node [head, below of=cls, node distance=1.5cm] (loc) {7x7 conv, 4 \textbf{Location}};
            
    %         \path[line] (input) -- (conv1);
    %         \path[line] (conv1) -- (bn);
    %         \path[line] (bn) -- (relu);
    %         \path[line] (relu) -- (maxpool);
    %         \path[line] (maxpool) -- (block1);
    %         \path[line] (block1) -- (block2);
    %         \path[line] (block2) -- (block3);
    %         \path[line] (block3) -- (block4);
    %         \path[line] (block4) -- (avgpool);
    %         \path[line] (avgpool) --  (flatten);	
    %         \path[line] (flatten) --  (cls);	
    %         \path[line] (block4) -| node [near end]{}([xshift=1.5cm] block4.east)
    %                             |- (loc.east) coordinate (loc);
    %     \end{tikzpicture}
    

\newcommand{\xceptionBSSD}{
    \usetikzlibrary{shapes,arrows}

     \tikzstyle{line} = [draw, -latex]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=40mm, node distance= 0.25cm]
    \tikzstyle{sepconv} = [rectangle, draw,  text centered, rounded corners, fill=\sepconvcol, text width=40mm, node distance= 0.25cm]
    \tikzstyle{rect} = [rectangle, draw, text centered, fill=\blockcol, minimum height=1em, node distance=0.25cm, text width=30mm]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners,  fill=\inputcol]
    \tikzstyle{box} = [rectangle, draw, text centered, fill=Orchid!60, node distance=0.3cm, text width=30mm]

    \begin{multicols}{3}   
        \subsection*{XceptionB/E}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
        
            \node [input] (input) {Input};
            \node [conv, below=of input] (conv1) {Conv. 3$\times$3$\times$32~/2};
            \node [conv, below=of conv1] (conv2) {Conv. 3$\times$3$\times$64};
    
            \node [rect, below=of conv2] (block4) {Blocks 1-7 \textbf{B[19\x 19\x 256]} \textbf{E[37\x 37\x 256]}};
            \node [rect, below=of block4] (block8) {Blocks 8-11 \textbf{[19\x 19\x 728]}};
            
            \node [rect, below=of block8] (block12) {Block 12};
            \node [sepconv, below=of block12] (conv4) {SepConv. 3$\times$3$\times$1536};
            \node [sepconv, below=of conv4] (conv5) {SepConv.~3$\times$3$\times$2048 \textbf{[10\x 10\x 2048]}};
  
            \node [box, below=of conv5] (extra) {Extra layers};
            \node [box, below=of extra] (cls) {Classification};
            \node [box, below=of cls] (loc) {Localization};
    
    
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (conv2);
            \path[line] (conv2) -- (block4);
            \path[line] (block4) -- (block8);
            \path[line] (block8) -- (block12);
            \path[line] (block12) -- (conv4);
            \path[line] (conv4) -- (conv5);
            \path[line] (conv5) -- (extra);
            
            % \path[line] (conv5) -| node [near end]{}([xshift=-.2cm] conv5.west)
            %                         |- (cls.west) coordinate (cls);
            % \path[line] (conv5) -| node [near end]{}([xshift=-.2cm] conv5.west)
            %                         |- (loc.west) coordinate (loc);
            % \path[line] (extra) -| node [near end]{}([xshift=-.5cm] extra.west)
            %                         |- (cls.west) coordinate (cls);
            % \path[line] (extra) -| node [near end]{}([xshift=.5cm] extra.east)
            %                         |- (loc.east) coordinate (loc);
    
            % \path[line] (block8) -| node [near end]{}([xshift=-0.6cm] block8.west)
            %                         |- (cls.west) coordinate (cls);
            % \path[line] (block4) -| node [near end]{}([xshift=-1.0cm] block4.west)
            %                         |- (cls.west) coordinate (cls);
            
            % \path[line] (block8) -| node [near end]{}([xshift=0.6cm] block8.east)
            %                         |- (loc.east) coordinate (loc);
            % \path[line] (block4) -| node [near end]{}([xshift=1.0cm] block4.east)
            %                         |- (loc.east) coordinate (loc);
                                
        \end{tikzpicture}
        \subsection*{XceptionC/F}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
        \node [input] (input) {Input};
            \node [conv, below=of input] (conv1) {Conv. 3$\times$3$\times$32, /2};
            \node [conv, below=of conv1] (conv2) {Conv. 3$\times$3$\times$64};
    
            \node [rect, below=of conv2] (block4) {Blocks 1-4  \textbf{C[19\x 19\x 256]} \textbf{F[37\x 37\x 256]}};
            \node [rect, below=of block4] (block8) {Blocks 8-10 \textbf{[19\x 19\x 728]}};
            
            \node [rect, below=of block8] (block12) {Blocks 11, 12};
            \node [sepconv, below=of block12] (conv4) {SepConv. 3$\times$3$\times$1536};
            \node [sepconv, below=of conv4] (conv5) {SepConv. 3$\times$3$\times$2048 \textbf{[10\x 10\x 2048]}};
            
            \node [box, below=of conv5] (extra) {Extra layers};
            \node [box, below=of extra] (cls) {Classification};
            \node [box, below=of cls] (loc) {Localization};
    
    
            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (conv2);
            \path[line] (conv2) -- (block4);
            \path[line] (block4) -- (block8);
            \path[line] (block8) -- (block12);
            \path[line] (block12) -- (conv4);
            \path[line] (conv4) -- (conv5);
            \path[line] (conv5) -- (extra);
    
            % \path[line] (conv5) -| node [near end]{}([xshift=-.2cm] conv5.west)
            %                         |- (cls.west) coordinate (cls);
            % \path[line] (conv5) -| node [near end]{}([xshift=.2cm] conv5.east)
            %                         |- (loc.east) coordinate (loc);
    
            % \path[line] (extra) -| node [near end]{}([xshift=-.5cm] extra.west)
            %                         |- (cls.west) coordinate (cls);
            % \path[line] (extra) -| node [near end]{}([xshift=.5cm] extra.east)
            %                         |- (loc.east) coordinate (loc);
    
            % \path[line] (block8) -| node [near end]{}([xshift=-0.6cm] block8.west)
            %                         |- (cls.west) coordinate (cls);
            % \path[line] (block4) -| node [near end]{}([xshift=-1.0cm] block4.west)
            %                         |- (cls.west) coordinate (cls);
            
            % \path[line] (block8) -| node [near end]{}([xshift=0.6cm] block8.east)
            %                         |- (loc.east) coordinate (loc);
            % \path[line] (block4) -| node [near end]{}([xshift=1.0cm] block4.east)
            %                         |- (loc.east) coordinate (loc);
        \end{tikzpicture}
        
    \end{multicols}

}  

\newcommand{\ssdtc}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=36mm, node distance= 0.45cm, minimum height=0.7cm]
    \tikzstyle{convl} = [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=37mm, node distance= 0.45cm, minimum height=1.3cm]
    \tikzstyle{convd} = [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=31mm, node distance= 0.25cm, minimum height=0.7cm]
\tikzstyle{det} = [rectangle, draw, text centered, rounded corners, fill=\convtdcol, text width=28mm, node distance= 1.8cm,]
    \tikzstyle{rect} = [rectangle, draw, text centered, fill=\blockcol, minimum height=1em, node distance=0.45cm, text width=30mm, minimum height=1.3cm]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners,  fill=\inputcol, minimum height=0.7cm, text width=30mm]
    \tikzstyle{box} = [rectangle, draw, text centered, fill=Orchid!60, node distance=0.3cm, text width=30mm]
    
    \subsection*{ResNet34-SSDTC}
    \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
    
        \node [input] (input) {};
        \node [conv, below=of input, text width=43mm] (conv1) {};
        \node [rect, minimum height=0.7cm, below=of conv1] (block1) {};
        \node [rect, below=of block1] (block2) {};
        \node [rect, below=of block2] (block3) {};
        \node [rect, below=of block3] (block4) {};
        \node [conv, below=of block4] (ext1) {};
        \node [convl, below=of ext1] (ext2) {};
        \node [conv, below=of ext2] (ext3) {};
        \node [convl, below=of ext3] (ext4) {};
        \node [conv, below=of ext4] (ext5) {};
        \node [convl, below=of ext5] (ext6) {};

        \path[line] (input) -- (conv1);
        \path[line] (conv1) -- (block1);
        \path[line] (block1) -- (block2);
        \path[line] (block2) -- (block3);
        \path[line] (block3) -- (block4);
        \path[line] (block4) -- (ext1);
        \path[line] (ext1) -- (ext2);
        \path[line] (ext2) -- (ext3);
        \path[line] (ext3) -- (ext4);
        \path[line] (ext4) -- (ext5);
        \path[line] (ext5) -- (ext6);
        
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \node [det]  at ($(ext3.east)+(2.5,+0.5)$)  (d34) {Conv3d P:0 1\x 1\x 3\x 256};
        \node [det, below= of d34] (d35) {Conv3d P:0 1\x 1\x 3\x 256};
        \node [det, below= of d35] (d36) {Conv3d P:0 1\x 1\x 3\x 256};
        \node [det, above= of d34] (d33) {Conv3d P:0 1\x 1\x 3\x 128};
        \node [det, above= of d33] (d32) {Conv3d P:0 1\x 1\x 3\x 128};
        \node [det, above= of d32] (d31) {Conv3d P:0 1\x 1\x 3\x 128};
        
        \node [det]  at ($(d34.east)+(-0.3,+1.4)$)  (d341) {Conv3d P:1,1,0 3\x 3\x 3\x 512};
        \node [det, below= of d341] (d351) {Conv3d P:1,1,0 3\x 3\x 3\x 512};
        \node [det, below= of d351] (d361) {Conv3d P:1,1,0 3\x 3\x 3\x 512};
        \node [det, above= of d341] (d331) {Conv3d P:1,1,0 3\x 3\x 3\x 256};
        \node [det, above= of d331] (d321) {Conv3d P:1,1,0 3\x 3\x 3\x 256};
        \node [det, above= of d321] (d311) {Conv3d P:1,1,0 3\x 3\x 3\x 256};
        
        \path[line] (d34) -- (d341);
        \path[line] (d35) -- (d351);
        \path[line] (d36) -- (d361);
        \path[line] (d33) -- (d331);
        \path[line] (d32) -- (d321);
        \path[line] (d31) -- (d311);

        
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%
        
        \node [convd] at ($(d311.east)+(2.1,-0.5)$) (loc1) {Conv. 3\x 3\x 4*4};
        \node [convd] at ($(d311.east)+(2.1,+0.5)$) (cls1) {Conv. 3\x 3\x 4*C};
        \node [convd] at ($(d321.east)+(2.1,-0.5)$) (loc2) {Conv. 3\x 3\x 6*4};
        \node [convd] at ($(d321.east)+(2.1,+0.5)$) (cls2) {Conv. 3\x 3\x 6*C};
        \node [convd] at ($(d331.east)+(2.1,-0.5)$) (loc3) {Conv. 3\x 3\x 6*4};
        \node [convd] at ($(d331.east)+(2.1,+0.5)$) (cls3) {Conv. 3\x 3\x 6*C};
        \node [convd] at ($(d341.east)+(2.1,-0.5)$) (loc4) {Conv. 3\x 3\x 6*4};
        \node [convd] at ($(d341.east)+(2.1,+0.5)$) (cls4) {Conv. 3\x 3\x 6*C};
        \node [convd] at ($(d351.east)+(2.1,-0.5)$) (loc5) {Conv. 3\x 3\x 4*4};
        \node [convd] at ($(d351.east)+(2.1,+0.5)$) (cls5) {Conv. 3\x 3\x 4*C};
        \node [convd] at ($(d361.east)+(2.1,-0.5)$) (loc6) {Conv. 3\x 3\x 4*4};
        \node [convd] at ($(d361.east)+(2.1,+0.5)$) (cls6) {Conv. 3\x 3\x 4*C};

        \path[line] (d311) -- (loc1);
        \path[line] (d311) -- (cls1);
        \path[line] (d321) -- (loc2);
        \path[line] (d321) -- (cls2);
        \path[line] (d331) -- (loc3);
        \path[line] (d331) -- (cls3);
        \path[line] (d341) -- (loc4);
        \path[line] (d341) -- (cls4);
        \path[line] (d351) -- (loc5);
        \path[line] (d351) -- (cls5);
        \path[line] (d361) -- (loc6);
        \path[line] (d361) -- (cls6);

        \draw[purple,line width=0.6mm,] ($(d31.north west)+(-0.3,1.6)$)  rectangle ($(d361.south east)+(0.2,-1.6)$);
\node [text=purple, font=\bfseries] at ($(d31.north)+(+0.7,2.0)$) (class) {\Large Temporal layers};
        
        %%%%%%%%%%%%%
        
        \path[line] (ext6) -- (d36);
        \path[line] (ext4) -- (d35);
        \path[line] (ext2) -- (d34);
        \path[line] (block4) -- (d33);
        \path[line] (block3) -- (d32);
        \path[line] (block2) -- (d31);

        %%%%%%%%%%%%%%%%
        
        \node [input] at ($(input.south)+(0.1,0.2)$) (input2) {};
        \node [conv, below=of input2, text width=43mm] (conv12) {};
        \node [rect, minimum height=0.7cm, below=of conv12] (block12) {};
        \node [rect, below=of block12] (block22) {};
        \node [rect, below=of block22] (block32) {};
        \node [rect, below=of block32] (block42) {};
        \node [conv, below=of block42] (ext12) {};
        \node [convl, below=of ext12] (ext22) {};
        \node [conv, below=of ext22] (ext32) {};
        \node [convl, below=of ext32] (ext42) {};
        \node [conv, below=of ext42] (ext52) {};
        \node [convl, below=of ext52] (ext62) {};
        
        \path[line] (input2) -- (conv12);
        \path[line] (conv12) -- (block12);
        \path[line] (block12) -- (block22);
        \path[line] (block22) -- (block32);
        \path[line] (block32) -- (block42);
        \path[line] (block42) -- (ext12);
        \path[line] (ext12) -- (ext22);
        \path[line] (ext22) -- (ext32);
        \path[line] (ext32) -- (ext42);
        \path[line] (ext42) -- (ext52);
        \path[line] (ext52) -- (ext62);
        
        %%%%%%%%%
        
        \path[line] (ext62) -- (d36);
        \path[line] (ext42) -- (d35);
        \path[line] (ext22) -- (d34);
        \path[line] (block42) -- (d33);
        \path[line] (block32) -- (d32);
        \path[line] (block22) -- (d31);
        
        %%%%%%%%%%%%%%%%%%%%%%%
        
        \node [input]  at ($(input2.south)+(0.1,0.2)$)  (input3) {};
        \node [conv, below=of input3, text width=43mm] (conv13) {};
        \node [rect, minimum height=0.7cm, below=of conv13] (block13) {};
        \node [rect, below=of block13] (block23) {};
        \node [rect, below=of block23] (block33) {};
        \node [rect, below=of block33] (block43) {};
        \node [conv, below=of block43] (ext13) {};
        \node [convl, below=of ext13] (ext23) {};
        \node [conv, below=of ext23] (ext33) {};
        \node [convl, below=of ext33] (ext43) {};
        \node [conv, below=of ext43] (ext53) {};
        \node [convl, below=of ext53] (ext63) {};

        \path[line] (input3) -- (conv13);
        \path[line] (conv13) -- (block13);
        \path[line] (block13) -- (block23);
        \path[line] (block23) -- (block33);
        \path[line] (block33) -- (block43);
        \path[line] (block43) -- (ext13);
        \path[line] (ext13) -- (ext23);
        \path[line] (ext23) -- (ext33);
        \path[line] (ext33) -- (ext43);
        \path[line] (ext43) -- (ext53);
        \path[line] (ext53) -- (ext63);
        
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        \path[line] (ext63) -- (d36);
        \path[line] (ext43) -- (d35);
        \path[line] (ext23) -- (d34);
        \path[line] (block43) -- (d33);
        \path[line] (block33) -- (d32);
        \path[line] (block23) -- (d31);
        
        %%%%%%%%%%%%%
        
        \node [input]  at ($(input3.south)+(0.1,0.2)$)  (input4) {};
        \node [conv, below=of input4, text width=43mm] (conv14) {};
        \node [rect, minimum height=0.7cm, below=of conv14] (block14) {};
        \node [rect, below=of block14] (block24) {};
        \node [rect, below=of block24] (block34) {};
        \node [rect, below=of block34] (block44) {};
        \node [conv, below=of block44] (ext14) {};
        \node [convl, below=of ext14] (ext24) {};
        \node [conv, below=of ext24] (ext34) {};
        \node [convl, below=of ext34] (ext44) {};
        \node [conv, below=of ext44] (ext54) {};
        \node [convl, below=of ext54] (ext64) {};

        \path[line] (input4) -- (conv14);
        \path[line] (conv14) -- (block14);
        \path[line] (block14) -- (block24);
        \path[line] (block24) -- (block34);
        \path[line] (block34) -- (block44);
        \path[line] (block44) -- (ext14);
        \path[line] (ext14) -- (ext24);
        \path[line] (ext24) -- (ext34);
        \path[line] (ext34) -- (ext44);
        \path[line] (ext44) -- (ext54);
        \path[line] (ext54) -- (ext64);
        

        %%%%%%%%%%%%%%%
        
       \path[line] (ext64) -- (d36);
        \path[line] (ext44) -- (d35);
        \path[line] (ext24) -- (d34);
        \path[line] (block44) -- (d33);
        \path[line] (block34) -- (d32);
        \path[line] (block24) -- (d31);
        
        %%%%%%%%%%%%%
        
        \node [input]  at ($(input4.south)+(0.1,0.2)$)  (input5) {Input [300\x 300]};
        \node [conv, below=of input5, text width=43mm] (conv15) {Conv. 7$\times$7$\times$64 /2 P:3};
        \node [rect, minimum height=0.7cm, below=of conv15] (block15) {Layer 1};
        \node [rect, below=of block15] (block25) {Layer 2 \textbf{[38\x 38\x 128]}};
        \node [rect, below=of block25] (block35) {Layer 3 \textbf{[19\x 19\x 256]}};
        \node [rect, below=of block35] (block45) {Layer 4 \textbf{[10\x 10\x 512]}};
        \node [conv, below=of block45] (ext15) {Conv. 1$\times$1$\times$256};
        \node [convl, below=of ext15] (ext25) {Conv. 3$\times$3$\times$512~/2 \textbf{[5\x 5\x 512]}};
        \node [conv, below=of ext25] (ext35) {Conv. 1$\times$1$\times$128};
        \node [convl, below=of ext35] (ext45) {Conv. 3$\times$3$\times$256~/2 \textbf{[3\x 3\x 256]}};
        \node [conv, below=of ext45] (ext55) {Conv. 1$\times$1$\times$128};
        \node [convl, below=of ext55] (ext65) {Conv. 3$\times$3$\times$256~P:0 \textbf{[1\x 1\x 256]}};

        \path[line] (input5) -- (conv15);
        \path[line] (conv15) -- (block15);
        \path[line] (block15) -- (block25);
        \path[line] (block25) -- (block35);
        \path[line] (block35) -- (block45);
        \path[line] (block45) -- (ext15);
        \path[line] (ext15) -- (ext25);
        \path[line] (ext25) -- (ext35);
        \path[line] (ext35) -- (ext45);
        \path[line] (ext45) -- (ext55);
        \path[line] (ext55) -- (ext65);
        
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \path[line] (ext65) -- (d36);
    \path[line] (ext45) -- (d35);
    \path[line] (ext25) -- (d34);
    \path[line] (block45) -- (d33);
    \path[line] (block35) -- (d32);
    \path[line] (block25) -- (d31);
        
    \end{tikzpicture}
}

\newcommand{\xceptionSSD}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{fline} = [draw, -latex, line width=0.8pt]
    \tikzstyle{conv} = [rectangle, draw,  text centered, rounded corners, fill=\convcol, text width=43mm, node distance= 0.25cm]
    \tikzstyle{sepconv} = [rectangle, draw,  text centered, rounded corners, fill=\sepconvcol, text width=40mm, node distance= 0.25cm]
    \tikzstyle{rect} = [rectangle, draw, text centered, fill=\blockcol, minimum height=1em, node distance=0.20cm, text width=43mm]
    \tikzstyle{input} = [rectangle, draw,  text centered, rounded corners,  fill=\inputcol]
    \tikzstyle{box} = [rectangle, draw, text centered, fill=Orchid!60, node distance=0.25cm, text width=30mm]
    
    \begin{multicols}{2}   
    \subsection*{XceptionA}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
        
            \node [input] (input) {Input [300\x 300]};
            \node [conv, below=of input] (conv1) {Conv. 3$\times$3$\times$32~/2 P:0};
            \node [conv, below=of conv1] (conv2) {Conv. 3$\times$3$\times$64 P:0};
    
            \node [rect, below=of conv2, fill=\blockcol!0] (block1) {Block 1 $\vert$ S:2 [74\x 74\x 128]};
            \node [rect, below=of block1, fill=\blockcol!30] (block2) {Block 2 $\vert$ S:2 [37\x 37\x 256]};
            \node [rect, below=of block2, fill=\blockcol!60] (block3) {Block 3 $\vert$ S:2 [19\x 19\x 728]};
            \node [rect, below=of block3, fill=\blockcol!60] (block4) {Blocks 4-7 $\vert$ S:1 [19\x 19\x 728]};
            \node [rect, below=of block4, fill=\blockcol!60] (block8) {Blocks 8 $\vert$ S:1 [19\x 19\x 728]};
            \node [rect, below=of block8, fill=\blockcol!60] (block9) {Blocks 9-11 $\vert$ S:1 [19\x 19\x 728]};
            \node [rect, below=of block9] (block12) {Block 12 $\vert$ S:2 [10\x 10\x 1024]};
             https://www.overleaf.com/project/5b781b245a769a24ac49c4f3
            \node [sepconv, below=of block12] (conv4) {SepConv.~3$\times$3$\times$1536};
            \node [sepconv, below=of conv4] (conv5) {SepConv.~3$\times$3$\times$2048 [10\x 10\x 2048]};

            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (conv2);
            \path[line] (conv2) -- (block1);
            \path[line] (block1) -- (block2);
            \path[line] (block2) -- (block3);
            \path[line] (block3) -- (block4);
            \path[line] (block4) -- (block8);
            \path[line] (block8) -- (block9);
            \path[line] (block9) -- (block12);
            \path[line] (block12) -- (conv4);
            \path[line] (conv4) -- (conv5);
            \path[line] (conv5.south) -- ($(conv5.south)+(0,-0.5)$);
            \path[line] (conv5.west) -- ($(conv5.west)+(-0.5, 0)$);
            \path[line] (conv5.east) -- ($(conv5.east)+(0.5, 0)$);
            
            \path[line] (block2.west) -- ($(block2.west)+(-0.5, 0)$);
            \path[line] (block2.east) -- ($(block2.east)+(0.5, 0)$);
            \path[line] (block9.west) -- ($(block9.west)+(-0.5, 0)$);
            \path[line] (block9.east) -- ($(block9.east)+(0.5, 0)$);
            

        \end{tikzpicture}
        
        \subsection*{XceptionH}
        \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
        
            \node [input] (input) {Input [300\x 300]};
            \node [conv, below=of input] (conv1) {Conv. 3$\times$3$\times$32~/2 P:0};
            \node [conv, below=of conv1] (conv2) {Conv. 3$\times$3$\times$64 P:0};
    
            \node [rect, below=of conv2, fill=\blockcol!0] (block1) {Block 1 $\vert$ S:2 [74\x 74\x 128]};
            \node [rect, below=of block1, fill=\blockcol!30] (block2) {Block 2 $\vert$ S:2 [37\x 37\x 256]};
            \node [rect, below=of block2, fill=\blockcol!30] (block3) {Block 3 $\vert$ \textbf{S:1} [37\x 37\x \textbf{256}]};
            \node [rect, below=of block3, fill=\blockcol!30] (block4) {Blocks 4-7 $\vert$~S:1 [37\x 37\x \textbf{256}]};
            \node [rect, below=of block4, fill=\blockcol!60] (block8) {Block 8 $\vert$ \textbf{S:2} [19\x 19\x \textbf{512}]};
            \node [rect, below=of block8, fill=\blockcol!60] (block9) {Blocks 9-11 $\vert$ S:1 [19\x 19\x \textbf{512}]};
            \node [rect, below=of block9] (block12) {Block 12 $\vert$ S:2 [10\x 10\x \textbf{728}]};
             
            \node [sepconv, below=of block12] (conv4) {SepConv.~3$\times$3$\times$\textbf{1024}};
            \node [sepconv, below=of conv4] (conv5) {SepConv.~3$\times$3$\times$1024  [10\x 10\x \textbf{1024}]};

            \path[line] (input) -- (conv1);
            \path[line] (conv1) -- (conv2);
            \path[line] (conv2) -- (block1);
            \path[line] (block1) -- (block2);
            \path[line] (block2) -- (block3);
            \path[line] (block3) -- (block4);
            \path[line] (block4) -- (block8);
            \path[line] (block8) -- (block9);
            \path[line] (block9) -- (block12);
            \path[line] (block12) -- (conv4);
            \path[line] (conv4) -- (conv5);
            \path[line] (conv5.south) -- ($(conv5.south)+(0,-0.5)$);
            \path[line] (conv5.west) -- ($(conv5.west)+(-0.5, 0)$);
            \path[line] (conv5.east) -- ($(conv5.east)+(0.5, 0)$);
            
            \path[line] (block4.west) -- ($(block4.west)+(-0.5, 0)$);
            \path[line] (block4.east) -- ($(block4.east)+(0.5, 0)$);
            \path[line] (block9.west) -- ($(block9.west)+(-0.5, 0)$);
            \path[line] (block9.east) -- ($(block9.east)+(0.5, 0)$);
            
            
        \end{tikzpicture}
    \end{multicols}
}



\newcommand{\modules}{
    \usetikzlibrary{shapes,arrows}

    \tikzstyle{line} = [draw, -latex]
    \tikzstyle{shared} = [rectangle, draw,  text centered, rounded corners,  fill=\sepconvcol]
    \tikzstyle{train} = [rectangle, draw,  text centered, rounded corners,  fill=\convcol]
    \tikzstyle{infer} = [rectangle, draw,  text centered, rounded corners,  fill=\convtdcol]
    
    % \subsection*{XceptionA}
    \begin{tikzpicture}[every text node part/.style={align=center}, node distance=1.2cm]
    
        \node [shared] (ssd) {\textbf{SSD} \\ {\tt ssd.py}};
        \node [shared] at ($(ssd)+(0.0,-2.0)$) (model) {\textbf{Network Model} \\ {\tt models/*}};
        \path[line] (ssd) -- (model);
        
        \node [train] at ($(ssd)+(-5.0,-2.0)$) (match) {\textbf{Ground-Truth Matching} \\ {\tt box\_utils.py}};
        \path[line] (ssd) -- (match);
        
        \node [train] at ($(ssd)+(-2.5,-4.0)$) (loss) {\textbf{Loss} \\ {\tt multibox\_loss.py}};
        \path[line] (model) -- (loss);
        \path[line] (match) -- (loss);
        
        \node [train] at ($(loss)+(-0,-2.0)$) (optim) {\textbf{Optimizer} \\ torch.optim.SGD};
        \path[line] (loss) -- (optim);
        
        \node [infer] at ($(ssd)+(+2.5,-4.0)$) (nms) {\textbf{Non Maximum} \\ \textbf{Suppression} \\ {\tt detection.py}};
        \path[line] (model) -- (nms);
        
        ------
        
        \node [infer] at ($(ssd)+(+2.5,2.0)$) (inp) {\textbf{Input images}};
        \path[line] (inp) -- (ssd);
        
        \node [train] at ($(ssd)+(-2.5,2.0)$) (load) {\textbf{Data Loader} \\ torch.utils.data.DataLoader};
        \path[line] (load) -- (ssd);
        
        \node [train] at ($(load)+(0,2.0)$) (aug) {\textbf{Augmentation} \\ {\tt data/preprocess.py}};
        \path[line] (aug) -- (load);
        
        \node [train] at ($(aug)+(0,2.0)$) (data) {\textbf{Dataset} \\ {\tt data/coco\_detection.py}};
        \path[line] (data) -- (aug);
        
        
        
        
    \end{tikzpicture}
}




